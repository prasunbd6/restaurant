import React, { useEffect, useState } from "react";
import axios from "axios";
import { BarLoader } from "react-spinners";
import { NavLink } from "react-router-dom";

const Home = () => {
  const [categoryTable, setCategoryTable] = useState([]);
  const [menuTable, setMenuTable] = useState([]);
  const [joinedTable, setJoinedTable] = useState([]);
  const [filteredData, setFilteredData] = useState(joinedTable);

  const fetchJoinedTable = () => {
    const joined = menuTable.map((menu) => {
      const category = categoryTable.find((cat) => cat.id === menu.category_id);
      return { ...menu, category_name: category.name }
    });
    setJoinedTable(joined);
  };

  const filterItems = (curritems) => {
    const updateItems = joinedTable.filter((destinationElement) => destinationElement.category_id === curritems);
    setFilteredData(updateItems);
  };

  
  

  const category = () => {
    axios
      .get("http://localhost:3001/category")
      .then((response) => {
        setCategoryTable(response.data);
      })
      .catch((err) => {
        console.log(err);
      });
  };

  const menu = () => {
    axios
      .get("http://localhost:3001/menu")
      .then((response) => {
        setMenuTable(response.data);
      })
      .catch((err) => {
        console.log(err);
      });
  };

  useEffect(() => {
    category();
    menu();
  }, []);

  const showAllItems = () => setFilteredData(joinedTable);

  useEffect(() => {
    if (menuTable.length && categoryTable.length) {
      fetchJoinedTable();
    }
  }, [menuTable, categoryTable]);

  

  return (
    <>
      <div className="container-fluid mt-5">
        <div className="row justify-content-center">
          <div className="col-lg-5 col-sm-12 col-md-6 col-xs-12">
            <nav className="navbar bg-body-tertiary">
              <div className="container-fluid">
                <i
                  className="nav-link btn btn-lg text-danger Sedgwick-font fs-3"
                  onClick={showAllItems}
                >
                  {" "}
                  All
                </i>
                {categoryTable.map((cat) => {
                  return (
                    <i
                      className="nav-link btn btn-lg text-danger Sedgwick-font fs-3"
                      onClick={() => filterItems(cat.id)}
                    >
                      {cat.name}
                    </i>
                  );
                })}
              </div>
            </nav>
          </div>
        </div>
      </div>

      <div className="container">
        <div className="row">
          {filteredData.map((menu) => {
            return (
              <div className="col-lg-3 col-md-4 col-sm-6 col-xs-6 mt-3">
                <div className="card">
                  <img src={menu.img} className="card-img-top" alt="..." />
                  <div className="card-body">
                    <h5 className="card-title">Title: {menu.title}</h5>
                    <p className="card-text text-danger">
                      Category: <b className="text-primary">{menu.category_name}</b>
                    </p>
                    <p className="card-text text-overflow">
                     
